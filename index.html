<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Plant√µes - Larissa</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #16a34a;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 { text-align: center; color: var(--primary); font-size: 1.5rem; }
        
        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        
        input[type="date"], select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checkbox-group input { width: auto; }

        button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        button:hover { background-color: #1d4ed8; }
        
        button.delete-btn {
            background-color: #ef4444;
            padding: 5px 10px;
            font-size: 0.8rem;
            width: auto;
            margin-left: 10px;
        }

        .summary {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--success);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th { background-color: #f8fafc; color: var(--secondary); }
        
        .settings-toggle {
            text-align: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--secondary);
            cursor: pointer;
            text-decoration: underline;
        }
        
        #settingsArea { display: none; }
        
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .badge-diurno { background-color: #dbeafe; color: #1e40af; }
        .badge-noturno { background-color: #e0e7ff; color: #3730a3; }

    </style>
</head>
<body>

<div class="container">
    <h1>üè• Plant√µes - Larissa</h1>

    <div class="settings-toggle" onclick="toggleSettings()">‚öôÔ∏è Gerenciar Feriados e Valor Hora</div>
    
    <div id="settingsArea" class="card">
        <div class="form-group">
            <label>Valor da Hora Base (R$)</label>
            <input type="number" id="valorHora" step="0.01" value="15.87">
        </div>
        <div class="form-group">
            <label>Cadastrar Feriado (Data)</label>
            <div style="display:flex; gap:10px;">
                <input type="date" id="newFeriado">
                <button onclick="addFeriado()" style="width: auto;">+</button>
            </div>
        </div>
        <div id="listaFeriados" style="font-size: 0.85rem; margin-top: 10px; color: var(--secondary);"></div>
    </div>

    <div class="card">
        <div class="form-group">
            <label for="dataPlantao">Data do Plant√£o</label>
            <input type="date" id="dataPlantao">
        </div>

        <div class="form-group">
            <label for="turno">Turno</label>
            <select id="turno">
                <option value="Diurno">Diurno (07h - 19h)</option>
                <option value="Noturno">Noturno (19h - 07h)</option>
            </select>
        </div>

        <div class="form-group checkbox-group">
            <input type="checkbox" id="vespera">
            <label for="vespera" style="margin:0; cursor:pointer;">√â V√©spera de Feriado?</label>
        </div>

        <button onclick="adicionarPlantao()">Adicionar Plant√£o</button>
    </div>

    <div class="card">
        <div class="summary">
            Total Estimado: <span id="valorTotal">R$ 0,00</span>
        </div>
    </div>

    <div class="card">
        <h3>Hist√≥rico</h3>
        <table id="tabelaPlantoes">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Detalhes</th>
                    <th>Valor</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <div style="margin-top: 15px; text-align: center;">
            <button onclick="limparHistorico()" style="background-color: var(--secondary); width: auto; font-size: 0.8rem;">Limpar Tudo</button>
        </div>
    </div>
</div>

<script>
    // --- ESTADO INICIAL ---
    // Carrega dados do LocalStorage ou inicia vazio
    let plantoes = JSON.parse(localStorage.getItem('plantoes_larissa')) || [];
    let feriados = JSON.parse(localStorage.getItem('feriados_larissa')) || [
        "2026-01-01", "2026-02-17", "2026-04-03", "2026-04-21", 
        "2026-05-01", "2026-06-04", "2026-09-07", "2026-10-12", 
        "2026-11-02", "2026-11-15", "2026-12-08", "2026-12-25"
    ]; // Alguns feriados padr√£o para 2026
    
    // Carrega valor hora salvo ou usa o padr√£o
    const savedValorHora = localStorage.getItem('valor_hora_larissa');
    if(savedValorHora) document.getElementById('valorHora').value = savedValorHora;

    // Define data de hoje no input
    document.getElementById('dataPlantao').valueAsDate = new Date();

    // --- L√ìGICA DE NEG√ìCIO ---

    function getValorHora() {
        return parseFloat(document.getElementById('valorHora').value) || 15.87;
    }

    function isFeriado(dataString) {
        return feriados.includes(dataString);
    }

    function calcularValor(dataString, turno, isVespera) {
        // Criando data corrigindo fuso hor√°rio (adicionando T12:00) para garantir o dia correto
        const dataObj = new Date(dataString + 'T12:00:00'); 
        const diaSemana = dataObj.getDay(); // 0 = Domingo, 6 = S√°bado
        const ehFeriado = isFeriado(dataString);
        const valorHora = getValorHora();
        
        let fator = 0;
        let descricao = "";

        // L√ìGICA ID√äNTICA AO EXCEL
        if (turno === "Diurno") {
            if (diaSemana === 0 || ehFeriado) {
                // Domingo ou Feriado
                fator = 12 * 2.0; 
                descricao = "Dom/Fer (100%)";
            } else {
                // Seg a Sab
                fator = 12 * 1.5;
                descricao = "Normal (50%)";
            }
        } 
        else if (turno === "Noturno") {
            if (diaSemana === 0 || ehFeriado) {
                // Domingo ou Feriado (Prioridade m√°xima)
                // 3h(100%) + 2h(125%) + 5h(75%) + 2h(50%)
                fator = (3*2.0) + (2*2.25) + (5*1.75) + (2*1.5);
                descricao = "Not. Dom/Fer";
            } else if (diaSemana === 6 || isVespera) {
                // S√°bado ou V√©spera
                // 3h(50%) + 2h(75%) + 5h(125%) + 2h(100%)
                fator = (3*1.5) + (2*1.75) + (5*2.25) + (2*2.0);
                descricao = "Not. S√°b/V√©sp";
            } else {
                // Noturno Comum (Seg-Sex)
                // 5h(50%) + 7h(75%)
                fator = (5*1.5) + (7*1.75);
                descricao = "Not. Comum";
            }
        }

        return {
            total: fator * valorHora,
            desc: descricao
        };
    }

    // --- INTERA√á√ÉO COM A UI ---

    function adicionarPlantao() {
        const data = document.getElementById('dataPlantao').value;
        const turno = document.getElementById('turno').value;
        const vespera = document.getElementById('vespera').checked;

        if (!data) { alert("Selecione uma data"); return; }

        const calculo = calcularValor(data, turno, vespera);

        const novoPlantao = {
            id: Date.now(),
            data: data,
            turno: turno,
            vespera: vespera,
            valor: calculo.total,
            desc: calculo.desc
        };

        plantoes.push(novoPlantao);
        salvarDados();
        renderizarTabela();
    }

    function removerPlantao(id) {
        if(confirm("Remover este plant√£o?")) {
            plantoes = plantoes.filter(p => p.id !== id);
            salvarDados();
            renderizarTabela();
        }
    }

    function limparHistorico() {
        if(confirm("Tem certeza que deseja apagar todo o hist√≥rico?")) {
            plantoes = [];
            salvarDados();
            renderizarTabela();
        }
    }

    function salvarDados() {
        localStorage.setItem('plantoes_larissa', JSON.stringify(plantoes));
        localStorage.setItem('valor_hora_larissa', document.getElementById('valorHora').value);
        renderizarResumo();
    }

    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function formatarData(dataString) {
        const partes = dataString.split('-');
        return `${partes[2]}/${partes[1]}/${partes[0]}`; // DD/MM/AAAA
    }

    function renderizarTabela() {
        const tbody = document.querySelector("#tabelaPlantoes tbody");
        tbody.innerHTML = "";

        // Ordenar por data (mais recente primeiro)
        const plantoesOrdenados = [...plantoes].sort((a, b) => new Date(b.data) - new Date(a.data));

        plantoesOrdenados.forEach(p => {
            const tr = document.createElement("tr");
            const badgeClass = p.turno === 'Diurno' ? 'badge-diurno' : 'badge-noturno';
            
            tr.innerHTML = `
                <td>
                    <strong>${formatarData(p.data)}</strong><br>
                    <span class="badge ${badgeClass}">${p.turno}</span>
                </td>
                <td>
                    <small>${p.desc}</small><br>
                    ${p.vespera ? '<small style="color:#f59e0b">‚òÖ V√©spera</small>' : ''}
                </td>
                <td style="color: var(--success); font-weight:bold;">${formatarMoeda(p.valor)}</td>
                <td><button class="delete-btn" onclick="removerPlantao(${p.id})">X</button></td>
            `;
            tbody.appendChild(tr);
        });
        renderizarResumo();
    }

    function renderizarResumo() {
        const total = plantoes.reduce((acc, curr) => acc + curr.valor, 0);
        document.getElementById("valorTotal").innerText = formatarMoeda(total);
    }

    // --- GERENCIAMENTO DE FERIADOS ---

    function toggleSettings() {
        const area = document.getElementById("settingsArea");
        area.style.display = area.style.display === "block" ? "none" : "block";
        renderizarListaFeriados();
    }

    function addFeriado() {
        const data = document.getElementById("newFeriado").value;
        if(data && !feriados.includes(data)) {
            feriados.push(data);
            localStorage.setItem('feriados_larissa', JSON.stringify(feriados));
            renderizarListaFeriados();
            alert("Feriado adicionado! (Recalculando plant√µes antigos automaticamente apenas se voc√™ editar o valor hora ou adicionar novos. Para atualizar passados, teria que reprocessar, mas para novos funcionar√° ok)");
        }
    }

    function renderizarListaFeriados() {
        const lista = document.getElementById("listaFeriados");
        lista.innerHTML = "<strong>Feriados Cadastrados:</strong> " + feriados.map(f => formatarData(f)).join(", ");
    }

    // Inicializa√ß√£o
    renderizarTabela();

</script>

</body>
</html>